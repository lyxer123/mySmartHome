(()=>{"use strict";var e={548:(e,t,s)=>{var r=s(751),a=s(220),o=s(641);const i={id:"app"};function n(e,t,s,r,a,n){const l=(0,o.g2)("router-view");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.bF)(l)])}const l={name:"App"};var d=s(262);const u=(0,d.A)(l,[["render",n]]),c=u;var h=s(33);const p={class:"login-container"},m={class:"login-card"},g={key:0,class:"error-message"},f={class:"form-group"},v={class:"form-group"},k={class:"form-actions"},b=["disabled"],y={class:"register-link"};function L(e,t,s,a,i,n){const l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",m,[t[7]||(t[7]=(0,o.Lk)("h2",null,"智能家居系统登录",-1)),i.errorMessage?((0,o.uX)(),(0,o.CE)("div",g,(0,h.v_)(i.errorMessage),1)):(0,o.Q3)("",!0),(0,o.Lk)("form",{onSubmit:t[2]||(t[2]=(0,r.D$)((...e)=>n.login&&n.login(...e),["prevent"]))},[(0,o.Lk)("div",f,[t[3]||(t[3]=(0,o.Lk)("label",{for:"username"},"用户名",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),required:"",placeholder:"请输入用户名"},null,512),[[r.Jo,i.username]])]),(0,o.Lk)("div",v,[t[4]||(t[4]=(0,o.Lk)("label",{for:"password"},"密码",-1)),(0,o.bo)((0,o.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":t[1]||(t[1]=e=>i.password=e),required:"",placeholder:"请输入密码"},null,512),[[r.Jo,i.password]])]),(0,o.Lk)("div",k,[(0,o.Lk)("button",{type:"submit",disabled:i.isLoading},(0,h.v_)(i.isLoading?"登录中...":"登录"),9,b),(0,o.Lk)("p",y,[t[6]||(t[6]=(0,o.eW)(" 还没有账号？ ",-1)),(0,o.bF)(l,{to:"/register"},{default:(0,o.k6)(()=>[...t[5]||(t[5]=[(0,o.eW)("立即注册",-1)])]),_:1})])])],32)])])}const w={name:"LoginView",data(){return{username:"",password:"",errorMessage:"",isLoading:!1}},methods:{async login(){this.isLoading=!0,this.errorMessage="";try{const e=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,password:this.password})}),t=await e.json();e.ok?(localStorage.setItem("token",t.token),localStorage.setItem("user",JSON.stringify(t.user)),this.$router.push("/dashboard")):this.errorMessage=t.message||"登录失败，请检查用户名和密码"}catch(e){this.errorMessage="登录请求失败，请稍后再试",console.error("Login error:",e)}finally{this.isLoading=!1}}}},S=(0,d.A)(w,[["render",L],["__scopeId","data-v-46365b44"]]),O=S,_={class:"register-container"},I={class:"register-card"},C={key:0,class:"error-message"},D={key:1,class:"success-message"},M={class:"form-group"},P={class:"form-group"},j={class:"form-group"},E={class:"form-group"},J={class:"form-actions"},T=["disabled"],x={class:"login-link"};function A(e,t,s,a,i,n){const l=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)("div",_,[(0,o.Lk)("div",I,[t[11]||(t[11]=(0,o.Lk)("h2",null,"智能家居系统注册",-1)),i.errorMessage?((0,o.uX)(),(0,o.CE)("div",C,(0,h.v_)(i.errorMessage),1)):(0,o.Q3)("",!0),i.successMessage?((0,o.uX)(),(0,o.CE)("div",D,(0,h.v_)(i.successMessage),1)):(0,o.Q3)("",!0),(0,o.Lk)("form",{onSubmit:t[4]||(t[4]=(0,r.D$)((...e)=>n.register&&n.register(...e),["prevent"]))},[(0,o.Lk)("div",M,[t[5]||(t[5]=(0,o.Lk)("label",{for:"username"},"用户名",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"username","onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),required:"",placeholder:"请输入用户名"},null,512),[[r.Jo,i.username]])]),(0,o.Lk)("div",P,[t[6]||(t[6]=(0,o.Lk)("label",{for:"email"},"邮箱 (可选)",-1)),(0,o.bo)((0,o.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":t[1]||(t[1]=e=>i.email=e),placeholder:"请输入邮箱"},null,512),[[r.Jo,i.email]])]),(0,o.Lk)("div",j,[t[7]||(t[7]=(0,o.Lk)("label",{for:"password"},"密码",-1)),(0,o.bo)((0,o.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":t[2]||(t[2]=e=>i.password=e),required:"",placeholder:"请输入密码"},null,512),[[r.Jo,i.password]])]),(0,o.Lk)("div",E,[t[8]||(t[8]=(0,o.Lk)("label",{for:"confirmPassword"},"确认密码",-1)),(0,o.bo)((0,o.Lk)("input",{type:"password",id:"confirmPassword","onUpdate:modelValue":t[3]||(t[3]=e=>i.confirmPassword=e),required:"",placeholder:"请再次输入密码"},null,512),[[r.Jo,i.confirmPassword]])]),(0,o.Lk)("div",J,[(0,o.Lk)("button",{type:"submit",disabled:i.isLoading},(0,h.v_)(i.isLoading?"注册中...":"注册"),9,T),(0,o.Lk)("p",x,[t[10]||(t[10]=(0,o.eW)(" 已有账号？ ",-1)),(0,o.bF)(l,{to:"/login"},{default:(0,o.k6)(()=>[...t[9]||(t[9]=[(0,o.eW)("立即登录",-1)])]),_:1})])])],32)])])}const $={name:"RegisterView",data(){return{username:"",email:"",password:"",confirmPassword:"",errorMessage:"",successMessage:"",isLoading:!1}},methods:{async register(){if(this.errorMessage="",this.successMessage="",this.password===this.confirmPassword)if(this.password.length<6)this.errorMessage="密码长度至少为6个字符";else{this.isLoading=!0;try{const e=await fetch("/api/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:this.username,email:this.email||null,password:this.password})}),t=await e.json();e.ok?(this.successMessage="注册成功！3秒后将跳转到登录页面...",this.resetForm(),setTimeout(()=>{this.$router.push("/login")},3e3)):this.errorMessage=t.message||"注册失败，请稍后再试"}catch(e){this.errorMessage="注册请求失败，请稍后再试",console.error("Registration error:",e)}finally{this.isLoading=!1}}else this.errorMessage="两次输入的密码不一致"},resetForm(){this.username="",this.email="",this.password="",this.confirmPassword=""}}},V=(0,d.A)($,[["render",A],["__scopeId","data-v-fce08b06"]]),F=V,X={class:"dashboard"},U={class:"dashboard-header"},q={class:"user-info"},N={class:"chart-container"},z={ref:"chart",style:{width:"100%",height:"400px"}},W={class:"data-container"},Q={class:"publish-form"};function R(e,t,s,a,i,n){return(0,o.uX)(),(0,o.CE)("div",X,[(0,o.Lk)("header",U,[t[3]||(t[3]=(0,o.Lk)("h1",null,"IoT数据监控系统",-1)),(0,o.Lk)("div",q,[(0,o.Lk)("span",null,"欢迎，"+(0,h.v_)(i.username),1),(0,o.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>n.logout&&n.logout(...e)),class:"logout-btn"},"退出登录")])]),(0,o.Lk)("div",N,[(0,o.Lk)("div",z,null,512)]),(0,o.Lk)("div",W,[t[4]||(t[4]=(0,o.Lk)("h2",null,"最新传感器数据",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(i.sensorData,e=>((0,o.uX)(),(0,o.CE)("div",{key:e.id,class:"data-item"},[(0,o.Lk)("p",null,"时间: "+(0,h.v_)(e.timestamp),1),(0,o.Lk)("pre",null,(0,h.v_)(JSON.stringify(e.data,null,2)),1)]))),128))]),(0,o.Lk)("div",Q,[t[6]||(t[6]=(0,o.Lk)("h2",null,"发布数据",-1)),(0,o.Lk)("form",{onSubmit:t[2]||(t[2]=(0,r.D$)((...e)=>n.publishData&&n.publishData(...e),["prevent"]))},[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.publishPayload=e),placeholder:'{"sensor": "temperature", "value": 25.5}'},null,512),[[r.Jo,i.publishPayload]]),t[5]||(t[5]=(0,o.Lk)("button",{type:"submit"},"发布",-1))],32)])])}var K=s(680);const B={name:"DashboardView",data(){return{username:"",sensorData:[],publishPayload:'{"sensor": "temperature", "value": 25.5}',refreshInterval:null,chart:null,chartData:{timestamps:[],values:[]}}},mounted(){const e=localStorage.getItem("user");if(e)try{const t=JSON.parse(e);this.username=t.username}catch(t){console.error("Failed to parse user data")}this.initChart(),this.loadData(),this.refreshInterval=setInterval(this.loadData,5e3)},beforeUnmount(){clearInterval(this.refreshInterval),this.chart&&this.chart.dispose()},watch:{sensorData(){this.chart&&this.updateChart()}},methods:{initChart(){this.chart=K.Ts(this.$refs.chart),this.updateChart()},updateChart(){const e={title:{text:"温度变化曲线"},tooltip:{trigger:"axis"},legend:{data:["温度值"]},xAxis:{type:"category",data:this.chartData.timestamps,name:"时间"},yAxis:{type:"value",name:"温度值(℃)"},series:[{name:"温度值",type:"line",data:this.chartData.values,smooth:!0}]};this.chart.setOption(e),window.addEventListener("resize",()=>{this.chart.resize()})},async loadData(){try{const e=localStorage.getItem("token");if(!e)return void this.$router.push("/login");const t=await fetch("/api/data?limit=10",{headers:{Authorization:e}});if(401===t.status)return localStorage.removeItem("token"),localStorage.removeItem("user"),void this.$router.push("/login");const s=await t.json();this.sensorData=s.data,this.chartData.timestamps=this.sensorData.map(e=>e.timestamp),this.chartData.values=this.sensorData.map(e=>e.data.value),this.chart&&this.updateChart()}catch(e){console.error("Failed to load data:",e)}},async publishData(){try{const e=localStorage.getItem("token");if(!e)return void this.$router.push("/login");const t=JSON.parse(this.publishPayload),s=await fetch("/api/publish",{method:"POST",headers:{"Content-Type":"application/json",Authorization:e},body:JSON.stringify(t)});if(401===s.status)return localStorage.removeItem("token"),localStorage.removeItem("user"),void this.$router.push("/login");s.ok?(alert("数据发布成功!"),this.publishPayload='{"sensor": "temperature", "value": 25.5}'):alert("数据发布失败!")}catch(e){alert("数据格式错误!"),console.error("Publish error:",e)}},async logout(){try{const e=localStorage.getItem("token");e&&await fetch("/api/logout",{method:"POST",headers:{Authorization:e}})}catch(e){console.error("Logout error:",e)}finally{localStorage.removeItem("token"),localStorage.removeItem("user"),this.$router.push("/login")}}}},G=(0,d.A)(B,[["render",R],["__scopeId","data-v-71554f52"]]),H=G,Y=[{path:"/",redirect:"/login"},{path:"/login",component:O},{path:"/register",component:F},{path:"/dashboard",component:H,meta:{requiresAuth:!0}}],Z=(0,a.aE)({history:(0,a.LA)(),routes:Y});Z.beforeEach((e,t,s)=>{const r=localStorage.getItem("token");e.meta.requiresAuth&&!r?s("/login"):s()});const ee=(0,r.Ef)(c);ee.use(Z),ee.mount("#app")}},t={};function s(r){var a=t[r];if(void 0!==a)return a.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,s),o.exports}s.m=e,(()=>{var e=[];s.O=(t,r,a,o)=>{if(!r){var i=1/0;for(u=0;u<e.length;u++){for(var[r,a,o]=e[u],n=!0,l=0;l<r.length;l++)(!1&o||i>=o)&&Object.keys(s.O).every(e=>s.O[e](r[l]))?r.splice(l--,1):(n=!1,o<i&&(i=o));if(n){e.splice(u--,1);var d=a();void 0!==d&&(t=d)}}return t}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[r,a,o]}})(),(()=>{s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}})(),(()=>{s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{s.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};s.O.j=t=>0===e[t];var t=(t,r)=>{var a,o,[i,n,l]=r,d=0;if(i.some(t=>0!==e[t])){for(a in n)s.o(n,a)&&(s.m[a]=n[a]);if(l)var u=l(s)}for(t&&t(r);d<i.length;d++)o=i[d],s.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return s.O(u)},r=self["webpackChunkiot_data_system_frontend"]=self["webpackChunkiot_data_system_frontend"]||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var r=s.O(void 0,[504],()=>s(548));r=s.O(r)})();
//# sourceMappingURL=app.f94d5860.js.map